// Rivet MarionetteJS (Backbone.Marionette)
// ----------------------------------
// v1.0.0
//
// Copyright (c)2014 eyolas <dtouzet@gmail.com>
// Distributed under MIT license
//
// http://marionettejs.com


/*!
 * Includes sightglass
 * https://github.com/mikeric/rivets/
 *
 * Includes rivets
 * https://github.com/mikeric/sightglass/
 */



!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore","backbone.marionette"],function(c,d){return a.Marionette=b(a,c,d)});else if("undefined"!=typeof exports){{var c=require("backbone"),d=require("underscore");require("backbone.marionette")}module.exports=b(a,c,d)}else a.Marionette=b(a,a.Backbone,a._)}(this,function(a,b){function c(a,b,c,e){return new d(a,b,c,e)}function d(a,b,c,d){this.options=d||{},this.options.adapters=this.options.adapters||{},this.obj=a,this.keypath=b,this.callback=c,this.objectPath=[],this.parse(),e(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function e(a){return"object"==typeof a&&null!==a}function f(a){throw new Error("[sightglass] "+a)}var g=b.Marionette;c.adapters={},d.tokenize=function(a,b,c){for(tokens=[],current={i:c,path:""},index=0;index<a.length;index++)chr=a.charAt(index),~b.indexOf(chr)?(tokens.push(current),current={i:chr,path:""}):current.path+=chr;return tokens.push(current),tokens},d.prototype.parse=function(){interfaces=this.interfaces(),interfaces.length||f("Must define at least one adapter interface."),~interfaces.indexOf(this.keypath[0])?(a=this.keypath[0],path=this.keypath.substr(1)):("undefined"==typeof(a=this.options.root||c.root)&&f("Must define a default root adapter."),path=this.keypath),this.tokens=d.tokenize(path,interfaces,a),this.key=this.tokens.pop()},d.prototype.realize=function(){return current=this.obj,unreached=!1,this.tokens.forEach(function(a,b){e(current)?("undefined"!=typeof this.objectPath[b]?current!==(prev=this.objectPath[b])&&(this.set(!1,a,prev,this.update.bind(this)),this.set(!0,a,current,this.update.bind(this)),this.objectPath[b]=current):(this.set(!0,a,current,this.update.bind(this)),this.objectPath[b]=current),current=this.get(a,current)):(unreached===!1&&(unreached=b),(prev=this.objectPath[b])&&this.set(!1,a,prev,this.update.bind(this)))},this),unreached!==!1&&this.objectPath.splice(unreached),current},d.prototype.update=function(){(next=this.realize())!==this.target&&(e(this.target)&&this.set(!1,this.key,this.target,this.callback),e(next)&&this.set(!0,this.key,next,this.callback),oldValue=this.value(),this.target=next,this.value()!==oldValue&&this.callback())},d.prototype.value=function(){return e(this.target)?this.get(this.key,this.target):void 0},d.prototype.setValue=function(a){e(this.target)&&this.adapter(this.key).set(this.target,this.key.path,a)},d.prototype.get=function(a,b){return this.adapter(a).get(b,a.path)},d.prototype.set=function(a,b,c,d){action=a?"observe":"unobserve",this.adapter(b)[action](c,b.path,d)},d.prototype.interfaces=function(){return interfaces=Object.keys(this.options.adapters),Object.keys(c.adapters).forEach(function(a){~interfaces.indexOf(a)||interfaces.push(a)}),interfaces},d.prototype.adapter=function(a){return this.options.adapters[a.i]||c.adapters[a.i]},d.prototype.unobserve=function(){this.tokens.forEach(function(a,b){(obj=this.objectPath[b])&&this.set(!1,a,obj,this.update.bind(this))},this),e(this.target)&&this.set(!1,this.key,this.target,this.callback)};var h;h={options:["prefix","templateDelimiters","rootInterface","preloadData","handler"],extensions:["binders","formatters","components","adapters"],"public":{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(a,b,c){return this.call(a,b,c.view.models)},configure:function(a){var b,c,d,e;null==a&&(a={});for(d in a)if(e=a[d],"binders"===d||"components"===d||"formatters"===d||"adapters"===d)for(c in e)b=e[c],h[d][c]=b;else h["public"][d]=e},bind:function(a,b,c){var d;return null==b&&(b={}),null==c&&(c={}),d=new h.View(a,b,c),d.bind(),d}}};var i,j,k;window.jQuery||window.$?(k="on"in jQuery.prototype?["on","off"]:["bind","unbind"],i=k[0],j=k[1],h.Util={bindEvent:function(a,b,c){return jQuery(a)[i](b,c)},unbindEvent:function(a,b,c){return jQuery(a)[j](b,c)},getInputValue:function(a){var b;return b=jQuery(a),"checkbox"===b.attr("type")?b.is(":checked"):b.val()}}):h.Util={bindEvent:function(){return"addEventListener"in window?function(a,b,c){return a.addEventListener(b,c,!1)}:function(a,b,c){return a.attachEvent("on"+b,c)}}(),unbindEvent:function(){return"removeEventListener"in window?function(a,b,c){return a.removeEventListener(b,c,!1)}:function(a,b,c){return a.detachEvent("on"+b,c)}}(),getInputValue:function(a){var b,c,d,e;if("checkbox"===a.type)return a.checked;if("select-multiple"===a.type){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],b.selected&&e.push(b.value);return e}return a.value}},h.TypeParser=function(){function a(){}return a.types={primitive:0,keypath:1},a.parse=function(a){return/^'.*'$|^".*"$/.test(a)?{type:this.types.primitive,value:a.slice(1,-1)}:"true"===a?{type:this.types.primitive,value:!0}:"false"===a?{type:this.types.primitive,value:!1}:"null"===a?{type:this.types.primitive,value:null}:"undefined"===a?{type:this.types.primitive,value:void 0}:isNaN(Number(a))===!1?{type:this.types.primitive,value:Number(a)}:{type:this.types.keypath,value:a}},a}(),h.TextTemplateParser=function(){function a(){}return a.types={text:0,binding:1},a.parse=function(a,b){var c,d,e,f,g,h,i;for(h=[],f=a.length,c=0,d=0;f>d;){if(c=a.indexOf(b[0],d),0>c){h.push({type:this.types.text,value:a.slice(d)});break}if(c>0&&c>d&&h.push({type:this.types.text,value:a.slice(d,c)}),d=c+b[0].length,c=a.indexOf(b[1],d),0>c){g=a.slice(d-b[1].length),e=h[h.length-1],(null!=e?e.type:void 0)===this.types.text?e.value+=g:h.push({type:this.types.text,value:g});break}i=a.slice(d,c).trim(),h.push({type:this.types.binding,value:i}),d=c+b[1].length}return h},a}();var l=function(a,b){return function(){return a.apply(b,arguments)}};h.View=function(){function a(a,b,c){var d,e,f,g,i,j,k,m,n,o,p,q;for(this.els=a,this.models=b,null==c&&(c={}),this.update=l(this.update,this),this.publish=l(this.publish,this),this.sync=l(this.sync,this),this.unbind=l(this.unbind,this),this.bind=l(this.bind,this),this.select=l(this.select,this),this.build=l(this.build,this),this.componentRegExp=l(this.componentRegExp,this),this.bindingRegExp=l(this.bindingRegExp,this),this.options=l(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),n=h.extensions,i=0,k=n.length;k>i;i++){if(e=n[i],this[e]={},c[e]){o=c[e];for(d in o)f=o[d],this[e][d]=f}p=h["public"][e];for(d in p)f=p[d],null==(g=this[e])[d]&&(g[d]=f)}for(q=h.options,j=0,m=q.length;m>j;j++)e=q[j],this[e]=c[e]||h["public"][e];this.build()}return a.prototype.options=function(){var a,b,c,d,e;for(b={},e=h.extensions.concat(h.options),c=0,d=e.length;d>c;c++)a=e[c],b[a]=this[a];return b},a.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},a.prototype.componentRegExp=function(){return new RegExp("^"+this.prefix.toUpperCase()+"-")},a.prototype.build=function(){var a,b,c,d,e,f,g,i;for(this.bindings=[],a=this.bindingRegExp(),c=this.componentRegExp(),b=function(a){return function(b,c,d,e){var f,g,i,j,k,l,m;return k={},m=function(){var a,b,c,d;for(c=e.split("|"),d=[],a=0,b=c.length;b>a;a++)l=c[a],d.push(l.trim());return d}(),f=function(){var a,b,c,d;for(c=m.shift().split("<"),d=[],a=0,b=c.length;b>a;a++)g=c[a],d.push(g.trim());return d}(),j=f.shift(),k.formatters=m,(i=f.shift())&&(k.dependencies=i.split(/\s+/)),a.bindings.push(new h[b](a,c,d,j,k))}}(this),e=function(d){return function(f){var g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;if(3===f.nodeType){if(p=h.TextTemplateParser,(m=d.templateDelimiters)&&(t=p.parse(f.data,m)).length&&(1!==t.length||t[0].type!==p.types.text)){for(w=0,A=t.length;A>w;w++)s=t[w],r=document.createTextNode(s.value),f.parentNode.insertBefore(r,f),1===s.type&&b("TextBinding",r,null,s.value);f.parentNode.removeChild(f)}}else if(1===f.nodeType)if(c.test(f.nodeName))u=f.nodeName.replace(c,"").toLowerCase(),d.bindings.push(new h.ComponentBinding(d,f,u));else{for(k="SCRIPT"===f.nodeName||"STYLE"===f.nodeName,E=f.attributes,x=0,B=E.length;B>x;x++)if(g=E[x],a.test(g.name)){if(u=g.name.replace(a,""),!(j=d.binders[u])){F=d.binders;for(n in F)v=F[n],"*"!==n&&-1!==n.indexOf("*")&&(q=new RegExp("^"+n.replace(/\*/g,".+")+"$"),q.test(u)&&(j=v))}j||(j=d.binders["*"]),j.block&&(k=!0,i=[g])}for(G=i||f.attributes,y=0,C=G.length;C>y;y++)g=G[y],a.test(g.name)&&(u=g.name.replace(a,""),b("Binding",f,u,g.value))}if(!k){for(H=function(){var a,b,c,d;for(c=f.childNodes,d=[],b=0,a=c.length;a>b;b++)o=c[b],d.push(o);return d}(),I=[],z=0,D=H.length;D>z;z++)l=H[z],I.push(e(l));return I}}}(this),i=this.els,f=0,g=i.length;g>f;f++)d=i[f],e(d);this.bindings.sort(function(a,b){var c,d;return((null!=(c=b.binder)?c.priority:void 0)||0)-((null!=(d=a.binder)?d.priority:void 0)||0)})},a.prototype.select=function(a){var b,c,d,e,f;for(e=this.bindings,f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)&&f.push(b);return f},a.prototype.bind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.bind());return e},a.prototype.unbind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e},a.prototype.sync=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.sync());return e},a.prototype.publish=function(){var a,b,c,d,e;for(d=this.select(function(a){return a.binder.publishes}),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.publish());return e},a.prototype.update=function(a){var b,c,d,e,f,g,h;null==a&&(a={});for(c in a)d=a[c],this.models[c]=d;for(g=this.bindings,h=[],e=0,f=g.length;f>e;e++)b=g[e],h.push(b.update(a));return h},a}();var l=function(a,b){return function(){return a.apply(b,arguments)}},m=[].slice,n={}.hasOwnProperty,o=function(a,b){function c(){this.constructor=a}for(var d in b)n.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},p=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};h.Binding=function(){function a(a,b,c,d,e){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=e?e:{},this.getValue=l(this.getValue,this),this.update=l(this.update,this),this.unbind=l(this.unbind,this),this.bind=l(this.bind,this),this.publish=l(this.publish,this),this.sync=l(this.sync,this),this.set=l(this.set,this),this.eventHandler=l(this.eventHandler,this),this.formattedValue=l(this.formattedValue,this),this.parseTarget=l(this.parseTarget,this),this.observe=l(this.observe,this),this.setBinder=l(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return a.prototype.setBinder=function(){var a,b,c,d;if(!(this.binder=this.view.binders[this.type])){d=this.view.binders;for(a in d)c=d[a],"*"!==a&&-1!==a.indexOf("*")&&(b=new RegExp("^"+a.replace(/\*/g,".+")+"$"),b.test(this.type)&&(this.binder=c,this.args=new RegExp("^"+a.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},a.prototype.observe=function(a,b,c){return h.sightglass(a,b,c,{root:this.view.rootInterface,adapters:this.view.adapters})},a.prototype.parseTarget=function(){var a;return a=h.TypeParser.parse(this.keypath),0===a.type?this.value=a.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},a.prototype.formattedValue=function(a){var b,c,d,e,f,g,i,j,k,l,n,o,p,q;for(q=this.formatters,e=l=0,o=q.length;o>l;e=++l){for(f=q[e],d=f.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),g=d.shift(),f=this.view.formatters[g],d=function(){var a,b,e;for(e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(h.TypeParser.parse(c));return e}(),j=[],b=n=0,p=d.length;p>n;b=++n)c=d[b],j.push(0===c.type?c.value:((k=this.formatterObservers)[e]||(k[e]={}),(i=this.formatterObservers[e][b])?void 0:(i=this.observe(this.view.models,c.value,this.sync),this.formatterObservers[e][b]=i),i.value()));(null!=f?f.read:void 0)instanceof Function?a=f.read.apply(f,[a].concat(m.call(j))):f instanceof Function&&(a=f.apply(null,[a].concat(m.call(j))))}return a},a.prototype.eventHandler=function(a){var b,c;return c=(b=this).view.handler,function(d){return c.call(a,this,d,b)}},a.prototype.set=function(a){var b;return a=this.formattedValue(a instanceof Function&&!this.binder["function"]?a.call(this.model):a),null!=(b=this.binder.routine)?b.call(this,this.el,a):void 0},a.prototype.sync=function(){var a,b;return this.set(function(){var c,d,e,f,g,h,i;if(this.observer){if(this.model!==this.observer.target){for(g=this.dependencies,c=0,e=g.length;e>c;c++)b=g[c],b.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(h=this.options.dependencies)?h.length:void 0))for(i=this.options.dependencies,d=0,f=i.length;f>d;d++)a=i[d],b=this.observe(this.model,a,this.sync),this.dependencies.push(b)}return this.observer.value()}return this.value}.call(this))},a.prototype.publish=function(){var a,b,c,d,e,f,g,h,i;if(this.observer){for(d=this.getValue(this.el),g=this.formatters.slice(0).reverse(),e=0,f=g.length;f>e;e++)b=g[e],a=b.split(/\s+/),c=a.shift(),(null!=(h=this.view.formatters[c])?h.publish:void 0)&&(d=(i=this.view.formatters[c]).publish.apply(i,[d].concat(m.call(a))));return this.observer.setValue(d)}},a.prototype.bind=function(){var a,b,c,d,e,f,g;if(this.parseTarget(),null!=(e=this.binder.bind)&&e.call(this,this.el),null!=this.model&&(null!=(f=this.options.dependencies)?f.length:void 0))for(g=this.options.dependencies,c=0,d=g.length;d>c;c++)a=g[c],b=this.observe(this.model,a,this.sync),this.dependencies.push(b);return this.view.preloadData?this.sync():void 0},a.prototype.unbind=function(){var a,b,c,d,e,f,g,h,i,j;for(null!=(g=this.binder.unbind)&&g.call(this,this.el),null!=(h=this.observer)&&h.unobserve(),i=this.dependencies,e=0,f=i.length;f>e;e++)d=i[e],d.unobserve();this.dependencies=[],j=this.formatterObservers;for(c in j){b=j[c];for(a in b)d=b[a],d.unobserve()}return this.formatterObservers={}},a.prototype.update=function(a){var b,c;return null==a&&(a={}),this.model=null!=(b=this.observer)?b.target:void 0,this.unbind(),null!=(c=this.binder.update)&&c.call(this,a),this.bind()},a.prototype.getValue=function(a){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,a):h.Util.getInputValue(a)},a}(),h.ComponentBinding=function(a){function b(a,b,c){var d,e,f,g,h;for(this.view=a,this.el=b,this.type=c,this.unbind=l(this.unbind,this),this.bind=l(this.bind,this),this.update=l(this.update,this),this.locals=l(this.locals,this),this.component=this.view.components[this.type],this.attributes={},this.inflections={},g=this.el.attributes||[],e=0,f=g.length;f>e;e++)d=g[e],h=d.name,p.call(this.component.attributes,h)>=0?this.attributes[d.name]=d.value:this.inflections[d.name]=d.value}return o(b,a),b.prototype.sync=function(){},b.prototype.locals=function(a){var b,c,d,e,f,g,h,i,j;null==a&&(a=this.view.models),f={},i=this.inflections;for(c in i)for(b=i[c],j=b.split("."),g=0,h=j.length;h>g;g++)e=j[g],f[c]=(f[c]||a)[e];for(c in a)d=a[c],null==f[c]&&(f[c]=d);return f},b.prototype.update=function(a){var b;return null!=(b=this.componentView)?b.update(this.locals(a)):void 0},b.prototype.bind=function(){var a,b;return null!=this.componentView?null!=(b=this.componentView)?b.bind():void 0:(a=this.component.build.call(this.attributes),(this.componentView=new h.View(a,this.locals(),this.view.options)).bind(),this.el.parentNode.replaceChild(a,this.el))},b.prototype.unbind=function(){var a;return null!=(a=this.componentView)?a.unbind():void 0},b}(h.Binding),h.TextBinding=function(a){function b(a,b,c,d,e){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=e?e:{},this.sync=l(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return o(b,a),b.prototype.binder={routine:function(a,b){return a.data=null!=b?b:""}},b.prototype.sync=function(){return b.__super__.sync.apply(this,arguments)},b}(h.Binding);var p=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};h["public"].binders.text=function(a,b){return null!=a.textContent?a.textContent=null!=b?b:"":a.innerText=null!=b?b:""},h["public"].binders.html=function(a,b){return a.innerHTML=null!=b?b:""},h["public"].binders.show=function(a,b){return a.style.display=b?"":"none"},h["public"].binders.hide=function(a,b){return a.style.display=b?"none":""},h["public"].binders.enabled=function(a,b){return a.disabled=!b},h["public"].binders.disabled=function(a,b){return a.disabled=!!b},h["public"].binders.checked={publishes:!0,priority:2e3,bind:function(a){return h.Util.bindEvent(a,"change",this.publish)},unbind:function(a){return h.Util.unbindEvent(a,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)===(null!=b?b.toString():void 0):!!b}},h["public"].binders.unchecked={publishes:!0,priority:2e3,bind:function(a){return h.Util.bindEvent(a,"change",this.publish)},unbind:function(a){return h.Util.unbindEvent(a,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)!==(null!=b?b.toString():void 0):!b}},h["public"].binders.value={publishes:!0,priority:2e3,bind:function(a){return this.event="SELECT"===a.tagName?"change":"input",h.Util.bindEvent(a,this.event,this.publish)},unbind:function(a){return h.Util.unbindEvent(a,this.event,this.publish)},routine:function(a,b){var c,d,e,f,g,h,i;if(null!=window.jQuery){if(a=jQuery(a),(null!=b?b.toString():void 0)!==(null!=(f=a.val())?f.toString():void 0))return a.val(null!=b?b:"")}else if("select-multiple"===a.type){if(null!=b){for(i=[],d=0,e=a.length;e>d;d++)c=a[d],i.push(c.selected=(g=c.value,p.call(b,g)>=0));return i}}else if((null!=b?b.toString():void 0)!==(null!=(h=a.value)?h.toString():void 0))return a.value=null!=b?b:""}},h["public"].binders["if"]={block:!0,priority:3e3,bind:function(a){var b,c;return null==this.marker?(b=[this.view.prefix,this.type].join("-").replace("--","-"),c=a.getAttribute(b),this.marker=document.createComment(" rivets: "+this.type+" "+c+" "),this.bound=!1,a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a;return null!=(a=this.nested)?a.unbind():void 0},routine:function(a,b){var c,d,e,f;if(!!b==!this.bound){if(b){e={},f=this.view.models;for(c in f)d=f[c],e[c]=d;return(this.nested||(this.nested=new h.View(a,e,this.view.options()))).bind(),this.marker.parentNode.insertBefore(a,this.marker.nextSibling),this.bound=!0}return a.parentNode.removeChild(a),this.nested.unbind(),this.bound=!1}},update:function(a){var b;return null!=(b=this.nested)?b.update(a):void 0}},h["public"].binders.unless={block:!0,priority:3e3,bind:function(a){return h["public"].binders["if"].bind.call(this,a)},unbind:function(){return h["public"].binders["if"].unbind.call(this)},routine:function(a,b){return h["public"].binders["if"].routine.call(this,a,!b)},update:function(a){return h["public"].binders["if"].update.call(this,a)}},h["public"].binders["on-*"]={"function":!0,priority:1e3,unbind:function(a){return this.handler?h.Util.unbindEvent(a,this.args[0],this.handler):void 0},routine:function(a,b){return this.handler&&h.Util.unbindEvent(a,this.args[0],this.handler),h.Util.bindEvent(a,this.args[0],this.handler=this.eventHandler(b))}},h["public"].binders["each-*"]={block:!0,priority:3e3,bind:function(a){var b,c,d,e,f;if(null==this.marker)b=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a);else for(f=this.iterated,d=0,e=f.length;e>d;d++)c=f[d],c.bind()},unbind:function(){var a,b,c,d,e;if(null!=this.iterated){for(d=this.iterated,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e}},routine:function(a,b){var c,d,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(j=this.args[0],b=b||[],this.iterated.length>b.length)for(u=Array(this.iterated.length-b.length),o=0,r=u.length;r>o;o++)e=u[o],n=this.iterated.pop(),n.unbind(),this.marker.parentNode.removeChild(n.els[0]);for(f=p=0,s=b.length;s>p;f=++p)if(i=b[f],d={index:f},d[j]=i,null==this.iterated[f]){v=this.view.models;for(g in v)i=v[g],null==d[g]&&(d[g]=i);l=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,k=this.view.options(),k.preloadData=!0,m=a.cloneNode(!0),n=new h.View(m,d,k),n.bind(),this.iterated.push(n),this.marker.parentNode.insertBefore(m,l.nextSibling)}else this.iterated[f].models[j]!==i&&this.iterated[f].update(d);if("OPTION"===a.nodeName){for(w=this.view.bindings,x=[],q=0,t=w.length;t>q;q++)c=w[q],x.push(c.el===this.marker.parentNode&&"value"===c.type?c.sync():void 0);return x}},update:function(a){var b,c,d,e,f,g,h,i;b={};for(c in a)d=a[c],c!==this.args[0]&&(b[c]=d);for(h=this.iterated,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(e.update(b));return i}},h["public"].binders["class-*"]=function(a,b){var c;return c=" "+a.className+" ",!b==(-1!==c.indexOf(" "+this.args[0]+" "))?a.className=b?""+a.className+" "+this.args[0]:c.replace(" "+this.args[0]+" "," ").trim():void 0},h["public"].binders["*"]=function(a,b){return null!=b?a.setAttribute(this.type,b):a.removeAttribute(this.type)};var p=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};h["public"].adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(a){var b;return a.hasOwnProperty(this.id)||(b=this.counter++,this.weakmap[b]={callbacks:{}},Object.defineProperty(a,this.id,{value:b})),this.weakmap[a[this.id]]},stubFunction:function(a,b){var c,d,e;return d=a[b],c=this.weakReference(a),e=this.weakmap,a[b]=function(){var b,f,g,h,i,j,k,l,m,n;h=d.apply(a,arguments),k=c.pointers;for(g in k)for(f=k[g],n=null!=(l=null!=(m=e[g])?m.callbacks[f]:void 0)?l:[],i=0,j=n.length;j>i;i++)(b=n[i])();return h}},observeMutations:function(a,b,c){var d,e,f,g,h,i;if(Array.isArray(a)){if(f=this.weakReference(a),null==f.pointers)for(f.pointers={},e=["push","pop","shift","unshift","sort","reverse","splice"],h=0,i=e.length;i>h;h++)d=e[h],this.stubFunction(a,d);if(null==(g=f.pointers)[b]&&(g[b]=[]),p.call(f.pointers[b],c)<0)return f.pointers[b].push(c)}},unobserveMutations:function(a,b,c){var d,e,f;return Array.isArray(a&&null!=a[this.id])&&(e=null!=(f=this.weakReference(a).pointers)?f[b]:void 0)&&(d=e.indexOf(c),d>=0)?e.splice(d,1):void 0},observe:function(a,b,c){var d,e;return d=this.weakReference(a).callbacks,null==d[b]&&(d[b]=[],e=a[b],Object.defineProperty(a,b,{enumerable:!0,get:function(){return e},set:function(f){return function(g){var h,i,j;if(g!==e){for(e=g,j=d[b].slice(),h=0,i=j.length;i>h;h++)c=j[h],p.call(d[b],c)>=0&&c();return f.observeMutations(g,a[f.id],b)}}}(this)})),p.call(d[b],c)<0&&d[b].push(c),this.observeMutations(a[b],a[this.id],b)},unobserve:function(a,b,c){var d,e;return d=this.weakmap[a[this.id]].callbacks[b],e=d.indexOf(c),e>=0&&d.splice(e,1),this.unobserveMutations(a[b],a[this.id],b)},get:function(a,b){return a[b]},set:function(a,b,c){return a[b]=c}};var q;return h.factory=function(a){return h.sightglass=a,h["public"]._=h,h["public"]},q=h.factory(c),g.ItemView.prototype.getTemplateData=function(){var a;return this.model?a={model:this.model}:this.collection&&(a={items:this.collection}),a},g.ItemView.prototype._oldRenderTemplate=g.ItemView.prototype._renderTemplate,g.ItemView.prototype._renderTemplate=function(){var a=this.getTemplate();if(a!==!1){if(!a)throw new g.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var b=this.getTemplateData();b=this.mixinTemplateHelpers(b);var c=g.Renderer.render(a,{},this);return this.attachElContent(c),this.binder=q.bind(this.el,b),this}},g.ItemView.prototype.oldDestroy=g.ItemView.prototype.destroy,g.ItemView.prototype.destroy=function(){return this.isDestroyed?void 0:(this.binder&&this.binder.unbind(),g.View.prototype.destroy.apply(this,arguments))},g});
//# sourceMappingURL=backbone.marionette.rivets.map